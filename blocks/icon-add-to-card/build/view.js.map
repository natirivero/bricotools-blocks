{"version":3,"file":"view.js","mappings":"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","sources":["webpack://bricotools-blocks/./blocks/icon-add-to-card/src/view.js"],"sourcesContent":["const setButtonState = (button, isLoading) => {\r\n  button.disabled = isLoading;\r\n  button.setAttribute('aria-busy', isLoading ? 'true' : 'false');\r\n};\r\n\r\nconst refreshFragments = async (fragmentsUrl) => {\r\n  const response = await fetch(fragmentsUrl, {\r\n    method: 'POST',\r\n    credentials: 'same-origin',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n    },\r\n    body: '',\r\n  });\r\n\r\n  if (!response.ok) {\r\n    return;\r\n  }\r\n\r\n  const data = await response.json();\r\n\r\n  if (!data || !data.fragments) {\r\n    return;\r\n  }\r\n\r\n  Object.entries(data.fragments).forEach(([selector, html]) => {\r\n    document.querySelectorAll(selector).forEach((element) => {\r\n      element.outerHTML = html;\r\n    });\r\n  });\r\n\r\n  if (data.cart_hash && window.localStorage) {\r\n    window.localStorage.setItem('wc_cart_hash', data.cart_hash);\r\n  }\r\n\r\n  if (window.localStorage) {\r\n    window.localStorage.setItem('wc_fragments', JSON.stringify(data.fragments));\r\n    window.localStorage.setItem('wc_fragments_created', Date.now().toString());\r\n  }\r\n\r\n  document.body.dispatchEvent(\r\n    new CustomEvent('btb:added_to_cart', {\r\n      detail: {\r\n        fragments: data.fragments,\r\n        cartHash: data.cart_hash || '',\r\n      },\r\n    }),\r\n  );\r\n};\r\n\r\nconst handleAddToCartClick = async (event) => {\r\n  const button = event.target.closest('.btb-ajax-add-to-cart');\r\n\r\n  if (!button) {\r\n    return;\r\n  }\r\n\r\n  event.preventDefault();\r\n\r\n  if (button.disabled) {\r\n    return;\r\n  }\r\n\r\n  const addToCartUrl = button.dataset.addToCartUrl;\r\n  const fragmentsUrl = button.dataset.fragmentsUrl;\r\n  const productId = button.dataset.productId;\r\n  const quantity = button.dataset.quantity || '1';\r\n\r\n  if (!addToCartUrl || !productId) {\r\n    return;\r\n  }\r\n\r\n  setButtonState(button, true);\r\n\r\n  try {\r\n    const body = new URLSearchParams({\r\n      product_id: productId,\r\n      quantity,\r\n    });\r\n\r\n    const response = await fetch(addToCartUrl, {\r\n      method: 'POST',\r\n      credentials: 'same-origin',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n      },\r\n      body: body.toString(),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Add to cart request failed');\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    if (data && data.error && data.product_url) {\r\n      window.location.assign(data.product_url);\r\n      return;\r\n    }\r\n\r\n    if (data && data.fragments) {\r\n      Object.entries(data.fragments).forEach(([selector, html]) => {\r\n        document.querySelectorAll(selector).forEach((element) => {\r\n          element.outerHTML = html;\r\n        });\r\n      });\r\n    } else if (fragmentsUrl) {\r\n      await refreshFragments(fragmentsUrl);\r\n    }\r\n\r\n    button.classList.add('is-added');\r\n  } catch (error) {\r\n    console.error(error);\r\n  } finally {\r\n    setButtonState(button, false);\r\n  }\r\n};\r\n\r\ndocument.addEventListener('click', handleAddToCartClick);\r\n"],"names":["setButtonState","button","isLoading","disabled","setAttribute","refreshFragments","fragmentsUrl","response","fetch","method","credentials","headers","body","ok","data","json","fragments","Object","entries","forEach","selector","html","document","querySelectorAll","element","outerHTML","cart_hash","window","localStorage","setItem","JSON","stringify","Date","now","toString","dispatchEvent","CustomEvent","detail","cartHash","handleAddToCartClick","event","target","closest","preventDefault","addToCartUrl","dataset","productId","quantity","URLSearchParams","product_id","Error","error","product_url","location","assign","classList","add","console","addEventListener"],"sourceRoot":""}